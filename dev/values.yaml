controllers:
  main:
    containers:
      main:
        image:
          repository: syncthing/syncthing
          tag: 1.27.3
        resources:
          requests:
            cpu: 15m
            memory: 64M
          limits:
            cpu: 100m
            memory: 128M
        securityContext:
          runAsUser: 1000
          runAsGroup: 1000

      cuda:
        image:
          repository: ghcr.io/rishikanthc/cuda-ssh
          tag: v0.0.3
        resources:
          requests:
            nvidia.com/gpu: 1
          limits:
            nvidia.com/gpu: 1
        command:
          - "/usr/sbin/sshd"
          - "-D"
          # - "/bin/bash"
          # - "-c"
          # - "while true; do sleep 30; done;"
        probes:
          liveness:
            enabled: false
          readiness:
            custom: true
            type: exec
            spec:
              exec:
                command:
                  - nvidia-smi

          startup:
            enabled: false

service:
  main:
    ports:
      http:
        port: 8384
  listen:
    enabled: true
    type: LoadBalancer
    controller: main
    externalTrafficPolicy: Local
    ipFamilyPolicy: PreferDualStack
    ports:
      discovery:
        enabled: true
        port: 21027
        protocol: UDP
      listen:
        enabled: true
        port: 22000
        protocol: TCP
      listen-udp:
        enabled: true
        port: 22000
        protocol: UDP
      ssh:
        enabled: true
        port: 22
        targetPort: 22
  cuda:
    enabled: true
    controller: main
    ports:
      http:
        enabled: true
        port: 9000

persistence:
  cookiejar:
    enabled: true
    type: hostPath
    hostPath: /home/rishi/cookiejar
    accessMode: ReadWriteMany
    retain: true
  syncthing:
    enabled: true
    accessMode: ReadWriteOnce
    size: 1Gi
    storageClass: longhorn
    advancedMounts:
      main:
        syncthing:
          - path: /var/syncthing
